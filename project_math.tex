\documentclass{article}
\usepackage{graphicx} % Required for inserting images
\usepackage{amsmath}  % For advanced math formatting
\usepackage{braket}   % For Dirac notation
\usepackage{physics}  % Optional: for common quantum physics notation
\usepackage{hyperref} % Optional: for clickable links
\usepackage{geometry} % Optional: to adjust page margins
\usepackage{tcolorbox}
\usepackage{minted}
\geometry{margin=1in}
\documentclass{article}
\usepackage{tikz}
\usepackage{amsmath}
\usepackage{tikz-3dplot}  % for 3D coordinate support

\title{Chemistry Summer Project}
\author{pp583}
\date{July 2025}

\begin{document}

\maketitle

\section{Procedure for finding parameters to feed into a machine learning model}

\subsection*{1. Get Localized Molecular Orbitals}

\begin{itemize}
    \item Generate a molecule.

    \item Using \verb|mf.mo_occ| and \verb|mf.mo_coeff|, split the molecular orbital (MO) coefficients into those corresponding to occupied and virtual (unoccupied) orbitals.

    \item The molecular orbitals ($\psi_i$) are expressed as:
    \[
    \psi_i = \sum_{\mu=1}^{K} \phi_\mu C_{\mu i}
    \]
    where K is the number of atomic orbitals
    \item After splitting, we define:
    \[
    \psi_i^{\mathrm{occ}} = \sum_{\mu=1}^{K} \phi_\mu C_{\mu i}
    \qquad \text{and} \qquad
    \psi_a^{\mathrm{vir}} = \sum_{\mu=1}^{K} \phi_\mu C_{\mu a}
    \]
    where $i = 1,2...N_{occ}$ and $a = 1,2...N_{vir} $
    \item Then we localize the orbitals by finding a unitary rotation:
    \[
    \widetilde{\psi}_{\mathrm{occ}} = \psi_{\mathrm{occ}} \mathrm{U}_{\mathrm{occ}}
    \qquad \text{and} \qquad
    \widetilde{\psi}_{\mathrm{vir}} = \psi_{\mathrm{vir}} \mathrm{U}_{\mathrm{vir}}
    \]

    \item In our coordinate system, set by the basis functions, we represent this as:
    \[
    \widetilde{C}_{\mu I}^{\mathrm{occ}} = \sum_{i} C_{\mu i}^{\mathrm{occ}} U_{iI}
    \qquad \text{and} \qquad
    \widetilde{C}_{\mu A}^{\mathrm{vir}} = \sum_{a} C_{\mu a}^{\mathrm{vir}} U_{aA}
    \]

    \item Then we stack the two matrices to obtain the new matrix with the coefficients of the localized molecular orbitals: \( \widetilde{C}  = (\widetilde{C}_{\mu I}^{\mathrm{occ}}, \widetilde{C}_{\mu I}^{\mathrm{vir}})\)
\end{itemize}

\subsection*{2. Perform Population Analysis on the Molecular Orbitals}

\begin{itemize}
    \item The number of electrons in each orbital is:
    \[
    n_i = \braket{\widetilde{\psi}_i} = 1
    \]

    \item In our chosen basis, this becomes:
    \[
    n_i = \sum_{\mu, \nu} \widetilde{C}_{\mu i}^{*} \widetilde{C}_{\nu i} \int \phi_{\mu}^{*}(r) \phi_{\nu}(r) \,dr = \sum_{\mu, \nu} \widetilde{C}_{\mu i}^{*} \widetilde{C}_{\nu i} S_{\mu \nu}
    \]

    \item We define the \textbf{atomic population} of orbital \( \psi_i \) on atom \( A \) as:
    \[
    q_A = \sum_{\mu \in A} \sum_{\nu} \widetilde{C}_{\mu i}^{*} \widetilde{C}_{\nu i} S_{\mu \nu} = \sum_{\mu \in A} \sum_{\nu} \widetilde{C}_{i \mu}^{\dagger} S_{\mu \nu} \widetilde{C}_{\nu i}
    \]

    \item By looking at \( q_A \) for the different atoms, we can determine which atoms the orbitals are centered on (along with knowing interatomic distances).
\end{itemize}

\subsection*{3. Calculate the Expectation Values of \( \hat{L}_z \) for the localized Molecular Orbitals}

\begin{itemize}
    \item The expectation value is:
    \[
    \bra{\widetilde{\psi}_i} {\hat{L}_z}\ket{\widetilde{\psi}_i} = \sum_{\mu,\nu} \widetilde{C}_{\mu i}^{*} \bra{\phi_\mu} \hat{L}_z \ket{\phi_\nu} \widetilde{C}_{\nu i} = \sum_{\mu,\nu} \widetilde{C}_{i \mu}^{\dagger} L_{\mu \nu} \widetilde{C}_{\nu i} = (\widetilde{C}^{\dagger} L \widetilde{C})_{ii}
    \]
    where \( L \) is the matrix representation of the angular momentum operator \(\hat{L}_z\) in the basis \( \{ \phi_\mu \} \) 

    However, since the matrix representation of $\hat{L}_z$ in a real-valued atomic orbital basis has vanishing diagonal elements, it is more appropriate to use the squared operator $\hat{L}_z^2$ to characterize the angular momentum of molecular orbitals.

    \[
    \bra{\widetilde{\psi}_i} {\hat{L}_z^{2}}\ket{\widetilde{\psi}_i} = \sum_{\mu,\nu} \widetilde{C}_{\mu i}^{*} \bra{\phi_\mu} \hat{L}_z^{2} \ket{\phi_\nu} \widetilde{C}_{\nu i} = \sum_{\mu,\nu} \widetilde{C}_{\mu i}^{*} \sum_{\lambda}( \bra{\phi_\mu} \hat{L}_z \ket{\phi_\lambda} \bra{\phi_\lambda} \hat{L}_z\ket{\phi_\nu}) \widetilde{C}_{\nu i} = \sum_{\mu,\nu} \widetilde{C}_{i \mu}^{\dagger} L_{\mu \nu}^2 \widetilde{C}_{\nu i} = (\widetilde{C}^{\dagger} L^2 \widetilde{C})_{ii}
    \]

    The \verb|pyscf| code for obtaining the $\hat{L}_z$ matrix is:

\begin{minted}[fontsize=\small, linenos]{python}
from pyscf.gto import moleintor
# Build molecule
mol = gto.Mole()
mol.atom = 'H 0 0 0; F 0 1.1 0'  
mol.basis = 'sto-3g'            
mol.build()

# Compute angular momentum operator integrals: r Ã— p
lz_3comp = moleintor.getints('int1e_cg_irxp_sph',
                             mol._atm, mol._bas, mol._env,
                             comp=3)
lz_matrix = lz_3comp[2]

\end{minted}

For the computation of the expectation values of $\hat{L}_z$, all molecular orbitals must be aligned along the \textbf{z-axis}. To achieve this, we use the \verb|rotate_coeffs| function from \verb|rotate.py| in the \verb|revqcmagic| repository.

This function requires the following inputs:
\begin{itemize}
    \item The \textbf{localized MO coefficient matrix}
    \item The \textbf{basis shell structure}, which can be extracted from the \verb|mol| object in \textbf{PySCF}
    \item The angle of rotation \textbf{ and the axis}, which are determined by identifying the atoms on which each orbital is localized and computing the orientation of the orbital. The required rotation to align this orientation vector with the z-axis is then applied.
\end{itemize}

By rotating each orbital in the z-axis direction, we ensure a consistent frame for computing $\langle \hat{L}_z \rangle$ values.

\begin{tcolorbox}[colback=blue!5!white, colframe=brown!75!black, title=Important Note]
For MOs that are centered on 2 atoms.
\end{tcolorbox}

To obtain the angle of rotation we simply need to find the angle between the z-axis($\textbf{$\hat{z}$}$) and the line connecting the two atoms on which the MOs are centered($\textbf{r}$):

\[
\theta = \cos^{-1}\left( \frac{ \mathbf{r} \cdot \hat{\mathbf{z}} }{ \left| \mathbf{r} \right| } \right)
\]

\begin{tcolorbox}[colback=blue!5!white, colframe=brown!75!black, title=Important Note]
For MOs that are centered on 3 atoms.
\end{tcolorbox}

To obtain the angle of rotation we simply need to find the angle between the z-axis($\textbf{$\hat{z}$}$) and the normal($\textbf{$\hat{n}$}$) to the plane formed by the 3 atoms on which the MO is centered.

\begin{center}
\begin{tikzpicture}[tdplot_main_coords, scale=1.2]

  % Atom positions in 3D
  \coordinate (A) at (0,0,0);
  \coordinate (B) at (2,1,0);
  \coordinate (C) at (4,0,1);

  % Draw atoms as spheres with labels
  \foreach \pos/\name in {A/A, B/B, C/C} {
    \shade[ball color=white] (\pos) circle (0.15);
    \node[below right] at (\pos) {\name};
  }

  % Draw triangle ABC
  \draw[dashed] (A) -- (B) -- (C) -- cycle;

  % Approximate center of the triangle (for vector origins)
  \coordinate (Center) at (2,0.33,0.33);

  % Normal vector from triangle plane
  \coordinate (Normal) at ($(Center)+(1,1,1)$);
  \draw[->, thick, red] (Center) -- (Normal) node[above right] {$\mathbf{\hat{z}}$};

  % z-axis from same origin
  \draw[->, thick, blue] (Center) -- ++(-1/2/1.87,3/2/1.87,-1/1.87) node[above] {$\mathbf{\hat{n}}$};

  % Angle theta between normal and z-axis
  \tdplotdrawarc[->]{(Center)}{0.3}{90}{45}{anchor=south}{$\theta$}

\end{tikzpicture}
\end{center}

we calculate $\mathbf{\hat{n}}$ by:

\[
\mathbf{n} = \vec{AC} \times \vec{AB}
\]
\[
\mathbf{\hat{n}} = \frac{\mathbf{n}}{|{\mathbf{n}}|}
\]

then we find the angle of rotation $\theta$ as:

\[
\theta = \cos^{-1}\left({ \mathbf{\hat{n}} \cdot \hat{\mathbf{z}} }\right)
\]

This way we align $\mathbf{\hat{n}}$ with the z-axis and the MO lies in the xy-plane.

\end{itemize}

\subsection*{4. Calculate the expectation values of \(\hat{F}\) for the localized Molecular orbitals(i.e estimate their energies)}

\begin{itemize}
    \item The expectation value is: 
    \[
    \bra{\widetilde{\psi}_i}\hat{F}\ket{\widetilde{\psi}_i} = \widetilde{\epsilon}_i
    \]

    \[
    \widetilde{\epsilon}_i = \int (\sum_{p} \psi_{p}^{*} U_{pi}^{*}) \hat{F}(\sum_{q} \psi_{q} U_{qi}) =
    \int (\sum_{p} \psi_{p}^{*} U_{pi}^{*})(\sum_{q} \epsilon_q \psi_{q} U_{qi}) =
    \sum_{pq} U_{pi}^{*}U_{qi}\epsilon_{q}\delta_{pq} = \sum_{pq} U_{ip}^{\dagger}U_{qi}\epsilon_{q}\delta_{pq} = \sum_{p} |U_{pi}|^{2}\epsilon_{p}
    \]
    this is a \textbf{weighted average} of the energies of the canonical MOs $\epsilon_p$
    U has the form:
    \[ U =  
    \begin{pmatrix}
    U^{occ} & 0 \\
    0 & U^{vir}
    \end{pmatrix}   
    \]

    if we turn $\epsilon_p$ into a diagonal matrix, then the above expression will have the following form:

    \[
    \widetilde{\epsilon}_i = (U^{\dagger}\epsilon U)_{ii}
    \]

\end{itemize}
\end{document}
